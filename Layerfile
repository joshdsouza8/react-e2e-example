# Node v12
FROM vm/ubuntu:22.04
MEMORY 2G
RUN curl -sL https://deb.nodesource.com/setup_18.x -o /tmp/nodesource_setup.sh
RUN sudo bash /tmp/nodesource_setup.sh
RUN sudo apt install nodejs
RUN node -v
RUN sudo npm install npm@latest -g

# node is a memory hog
ENV NODE_OPTIONS=--max-old-space-size=8192
    
COPY . .
RUN mkdir cypress
RUN npm install
RUN BACKGROUND npm start
RUN BACKGROUND cd cypress && python3 -m http.server 8000

RUN ./node_modules/.bin/cypress run

# start a webserver to view test results, open
EXPOSE WEBSITE http://localhost:8000
